%
O5570(CIRCLE POCKET MILLING MACRO)
(26-07-2024 - A)
(BASED ON - A.INCE 21/02/19)
(THIS MACRO HELICAL RAMPS DOWN)
(THEN SPIRALS OUT TO FINAL SIZE)
(TYPE I ARGUMENTS)

(TOOL INFO)
#102 = #7 (D - TOOL DIAMETER MM)
#151 = #9 (F - FEED RATE)

(CUT INFO)
#180 = #24 (X - POSITION OF POCKET)
#181 = #25 (Y - POSITION OF POCKET)
#110 = #11 (H - FINAL DIAMETER MM)
#111 = #26 (Z - FINAL DEPTH MM)
#112 = #17 (Q - NUMBER OF PECKS IN Z)
#113 = 0.1 (RADIAL ENGAGEMENT OF CUTTER, 0.2 = 20PCT)
#114 = 0.2 (FINISHING ALLOWANCE ON DIAMETER MM)
#115 = 0.2 (FINISHING ALLOWANCE ON FLOOR MM)
#116 = 0.3 (RAMPING FEED RATE FACTOR, 0.5 = HALF FEED)
#117 = 2. (RAMPING ANGLE, IN DEGREES, 2 STANDARD)
#118 = #18 (R - RETURN HEIGHT MM)
#119 = 1.8 (HELIX SIZE FACTOR E.G. 10MM TOOL *1.8 = 18MM)
(1.8 STANDARD, KEEP BETWEEN 1.1 AND 1.9)

(FORMULAS, DON'T CHANGE)
#152 = FUP[#151*#116] (RAMPING FEED RATE)
#153 = [#102*#119](DIAMETER OF INITAL HELICAL RAMP)
#154 = [[#111-#115]/#112](DEPTH OF CUT IN Z)
#155 = [#153-#102] (DIAMETER OF CENTRELINE OF TOOL)
#156 = [[3.14*#155*[TAN#117]] (DEPTH OF CUT PER HELIX)
#157 = FUP[[#154/#156]] (NUMBER OF HELIXES TO REACH Z DEPTH)
#170 =[#154/#157] (ADJUSTED DEPTH OF CUT PER HELIX)
#159 = [#102*#113] (STEP OVER)
#160 = FIX[[#110-#114-#153-[#159*2]]/#159] (NUMBER OF 1/2 CIRCLES NEEDED)
#164 = [#110-#102-#114] (FINAL DIAMETER ADJUSTED)

(ERROR CHECKS DON'T CHANGE)
IF[#119GT1.9]THEN#3006 = 1(#119 TOO LARGE)
IF[#119LT1.1]THEN#3006 = 2(#119 TOO SMALL)
IF[[#102*1.1]GT[#110-#114]]THEN#3006 = 3 (TOOL TOO LARGE)
IF[#153GT[#110-#114]]THEN#3006 = 4(#119 TOO LARGE)

#165 = 0 (NUMBER OF PASSES LOOP COUNTER)
WHILE [#165LT#112]DO1
#158 = -1. (LOOP COUNTER FOR HELICAL RAMP)
#161 = -1. (LOOP COUNTER FOR SPIRAL)
#162 = #155 (CURRENT DIAMETER)
#163 = 1. (POSITIVE, NEGATIVE ALTERNATOR)
#164 = [#110-#102-#114] (FINAL DIAMETER ADJUSTED)

G0 X#180 Y#181 (X,Y POSITION OF FEATURE)
U[[#155/2]+[#159/4]] V0.(START POSITION OF HELIX, NOT CENTRED ON POCKET)
G0 Z#118 (RAPID TO RETURN HEIGHT)
G01 Z#170-[#165*#154] F3000 (ONE HELIX HEIGHT ABOVE SURFACE)
WHILE [#158 LT #157] DO2
G3 I-[#155/2]W-#170 F#152 (DOES HELICAL RAMP)
#158=[#158+1](INCREMENTS LOOP)
END2

WHILE [#161 LT #160] DO2
#161 = [#161+1] (INCREMENTS LOOP)
#162 = [#162+#159] (ADDS STEP OVER TO CURRENT DIAMETER)
#162 = [#162*#163] (GIVES NEW CURRENT DIA CORRECT POLARITY)
#163 = [#163*-1] (SWAPS POLARITY FOR NEXT CUT)
G3 I-[#162/2] U-#162 F#151 (DOES SPIRAL CUTS)
#162 = ABS[#162] (MAKES CURRENT DIA POSITIVE)
END2

#164 = [#164*#163] (CORRECTS POLARITY)
#166 = [[[[[[#162+[#159/2]]/2]*#163]+[#164/2]]/2]] (BLENDS SPIRAL INTO CIRCLE)
G3 X-[[#164/2]-#180]I-#166 (FIRST HALF)
G3 I[#164/2] (FINISHES FINAL DIAMETER)
G1 Z#118 (RETURN HEIGHT)
#165=#165+1
END1

M99
%